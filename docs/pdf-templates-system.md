# نظام قوالب PDF المخصصة

## نظرة عامة
تم تطوير نظام قوالب PDF مخصص لمديرية مالية حلب يوفر إمكانيات متقدمة لتخصيص وإنتاج إيصالات الطلبات والتقارير.

## الميزات الرئيسية

### 1. إدارة القوالب
- **إنشاء قوالب جديدة**: إمكانية إنشاء قوالب مخصصة من الصفر
- **تحرير القوالب**: تعديل القوالب الموجودة بواجهة بصرية سهلة
- **استيراد/تصدير**: حفظ ومشاركة القوالب عبر ملفات JSON
- **معاينة مباشرة**: عرض القالب قبل الحفظ ببيانات تجريبية

### 2. أنواع القوالب المدعومة
- `ticket_confirmation` - إيصالات تأكيد الطلبات
- `ticket_report` - تقارير الطلبات
- `department_report` - تقارير القسم
- `monthly_report` - التقارير الشهرية

### 3. إعدادات التخصيص

#### الهيدر (Header)
- عنوان رئيسي وفرعي
- خيار إضافة الشعار
- تخصيص النصوص

#### المحتوى (Content)
- عنوان المحتوى الرئيسي
- أقسام قابلة للتخصيص مع:
  - تسميات مخصصة لكل حقل
  - أحجام خطوط مختلفة
  - ألوان مخصصة
  - خيارات النص المتعدد الأسطر

#### الفوتر (Footer)
- نص الفوتر القابل للتعديل
- QR Code اختياري لتتبع الطلب
- طابع زمني تلقائي

#### إعدادات التصميم
- أحجام الصفحة: A4, A5, Letter
- هوامش مخصصة (أعلى، يمين، أسفل، يسار)
- عائلة الخط
- ألوان رئيسية وثانوية
- لون الخلفية

## كيفية الاستخدام

### الوصول لإدارة القوالب
1. انتقل إلى صفحة **الأدوات** (`/#/tools`)
2. ابحث عن كارت **قوالب PDF**
3. انقر لفتح واجهة إدارة القوالب

### إنشاء قالب جديد
1. انقر على **"إضافة قالب جديد"**
2. سيتم إضافة قالب افتراضي جديد
3. انقر **"تحرير"** لتخصيص القالب
4. قم بتعديل:
   - اسم القالب
   - نوع القالب
   - نصوص الهيدر والفوتر
   - إعدادات التصميم
5. انقر **"حفظ"** لحفظ التغييرات

### تحرير قالب موجود
1. ابحث عن القالب في القائمة
2. انقر **"تحرير"**
3. قم بالتعديلات المطلوبة
4. استخدم **"معاينة PDF"** لمراجعة التغييرات
5. **"حفظ"** التغييرات

### استيراد قالب
1. انقر **"استيراد قالب"**
2. اختر ملف JSON صالح للقالب
3. سيتم إضافة القالب للقائمة تلقائياً

### تصدير قالب
1. انقر **"تصدير"** بجوار القالب المطلوب
2. سيتم تنزيل ملف JSON يحتوي على إعدادات القالب

### استخدام القوالب في إيصالات الطلبات
عند تقديم طلب جديد:
1. في صفحة التأكيد، ستجد أزرار PDF محدثة
2. إذا كانت هناك قوالب مخصصة:
   - **"تنزيل إيصال PDF (قالب مخصص)"** - يستخدم القوالب الجديدة
   - **"تنزيل إيصال PDF (تقليدي)"** - يستخدم النظام القديم
3. إذا لم توجد قوالب مخصصة، سيظهر الزر التقليدي فقط

## الملفات والمكونات

### ملفات النظام الأساسية
- `utils/pdfTemplateGenerator.ts` - محرك إنتاج PDF بالقوالب
- `utils/confirmationPdfIntegration.ts` - تكامل القوالب مع صفحة التأكيد
- `pages/ToolsPage.tsx` - مكون PdfTemplateManager

### التخزين
- القوالب محفوظة في `localStorage` تحت مفتاح `pdfTemplates`
- كل قالب له ID فريد وبيانات وصفية (تاريخ الإنشاء/التحديث)

### هيكل بيانات القالب
```typescript
interface PdfTemplate {
  id: string;
  name: string;
  type: 'ticket_confirmation' | 'ticket_report' | 'department_report' | 'monthly_report';
  header: {
    title: string;
    subtitle: string;
    logo: boolean;
  };
  content: {
    title: string;
    sections: Array<{
      label: string;
      field: string;
      style: {
        fontSize?: number;
        bold?: boolean;
        color?: string;
        multiline?: boolean;
      };
    }>;
  };
  footer: {
    text: string;
    qrCode: boolean;
    timestamp: boolean;
  };
  styling: {
    pageSize: 'A4' | 'A5' | 'Letter';
    margins: { top: number; right: number; bottom: number; left: number };
    fontFamily: string;
    primaryColor: string;
    secondaryColor: string;
    backgroundColor: string;
  };
  createdAt?: string;
  updatedAt?: string;
}
```

## المزايا والفوائد

### للمستخدمين النهائيين
- إيصالات أكثر احترافية ووضوحاً
- تصميم متسق مع هوية المديرية
- QR Code لسهولة التتبع
- معلومات واضحة ومنظمة

### للإدارة
- تحكم كامل في شكل ومحتوى الإيصالات
- إمكانية التحديث السريع للقوالب دون تطوير
- توحيد معايير التصميم
- سهولة النسخ الاحتياطي والاستعادة

### للتطوير والصيانة
- نظام معياري وقابل للتوسع
- فصل المحتوى عن التصميم
- API واضح للتكامل مع أجزاء أخرى من النظام
- سهولة إضافة أنواع قوالب جديدة

## إرشادات للمطورين

### إضافة نوع قالب جديد
1. أضف النوع الجديد لـ enum في `PdfTemplate['type']`
2. أضف منطق معالجة النوع في `generatePdfFromTemplate`
3. أضف خيار النوع في واجهة المستخدم

### تخصيص إنتاج PDF
- استخدم `generatePdfFromTemplate` مع قالب وبيانات
- يمكن تمرير خيارات إضافية (اسم الملف، نمط العرض)
- النظام يدعم Arabic RTL تلقائياً

### التكامل مع صفحات أخرى
```typescript
import { generateTicketPdf } from '../utils/pdfTemplateGenerator';

// إنتاج PDF للطلب
await generateTicketPdf(ticket, templateId);
```

## التحسينات المستقبلية المقترحة
1. **دعم الخطوط العربية**: إضافة خطوط عربية للتحسين البصري
2. **مكتبة QR Code محلية**: تقليل الاعتماد على APIs خارجية
3. **قوالب متقدمة**: دعم الجداول والرسوم البيانية
4. **طباعة مجمعة**: طباعة عدة إيصالات في ملف واحد
5. **التواقيع الرقمية**: إضافة إمكانية التوقيع على الإيصالات
6. **تقارير الاستخدام**: إحصائيات حول استخدام القوالب

## الدعم الفني
للاستفسارات التقنية أو طلب ميزات جديدة، يرجى التواصل مع فريق التطوير مع تفاصيل:
- نوع القالب المطلوب
- التخصيصات المحددة
- أي ملفات مرجعية أو أمثلة

---

*تم تطوير هذا النظام لخدمة مديرية مالية حلب وتحسين تجربة المواطنين في الحصول على الخدمات الحكومية الرقمية.*