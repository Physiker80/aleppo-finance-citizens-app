# وثيقة التحليل الشامل للمزايا والعيوب للنظام

تاريخ الإصدار: 2025-09-23

الجهة: مديرية مالية حلب — نظام الاستعلامات والشكاوى (ويب + أندرويد عبر Capacitor)

المستند: تقييم شامل بعد تطبيق مجموعة تحديثات أمنية وتجهيزية حديثة (إشعارات/جلسات/دليل أمني/لوحة مراقبة/تحسينات التوافق)

---

## 1) الملخص التنفيذي
هذا التقرير يقيّم نقاط القوة والضعف في النظام بعد التحديثات الأمنية الأخيرة، ويقترح خريطة طريق عملية قابلة للتنفيذ. بشكل عام، ارتفع نضج الأمان والتجربة بسبب: توحيد نقاط الوصول إلى المراقبة، تحسين التحكم في الإشعارات، إضافة دلائل أمنية سياقية قابلة للإغلاق، وتحسينات الاستمرارية عند تعطل الخدمات الخلفية. لا تزال هناك فجوات مهمة في العزل البياني، الحوكمة الرسمية للتراخيص، وبعض الجوانب المتعلقة بالخصوصية والتوافق.

- درجة السلامة العامة: 78/100 (↑ تحسّن ملحوظ مقارنة بالإصدار السابق)
- مستوى المخاطر الحالي: متوسط مائل للانخفاض مع وجود مخاطر هيكلية تتطلب معالجة مرحلية
- الأولويات القريبة: تقليل الاعتماد على localStorage لحفظ بيانات حساسة، ترسيخ ضوابط RBAC على مستوى البيانات، توثيق سياسات خصوصية رسمية، ورفع تغطية الاختبارات

---

## 2) نطاق التقييم ومنهجيته
- النطاق: الواجهة الأمامية (React + TypeScript + Vite) والتكاملات (Capacitor، صفحات المراقبة، مكونات الدليل الأمني، إدارة الجلسات وRBAC). لا يشمل هذا التقرير مراجعة شفرة خادمية كاملة، ويتم الاعتماد على سلوك الواجهات والنمط المعماري المتاح.
- المنهجية:
  - مراجعة معمارية: مكونات الحالة، التخزين المحلي، النمط الأمني، تدفق تذاكر المواطنين
  - فحص تحديثات الأمن الأخيرة وتأثيرها على تجربة المستخدم والمخاطر
  - تحليل مخاطر نوعي مع تصنيف الشدة/الاحتمال
  - توصيات قابلة للتنفيذ مع أولويات زمنية

---

## 3) نظرة معمارية مختصرة
- React 19 + Vite 6، توجيه عبر `hash` في `App.tsx`
- إدارة الحالة عبر `AppContext` مع ثبات محلي `localStorage`
- ميزات: نظام تذاكر، صلاحيات حسب الدور/القسم، إشعارات، دلائل أمنية تفاعلية (Mermaid)، PDF/QR/OCR عند الحاجة عبر استيراد ديناميكي
- تطبيق أندرويد عبر Capacitor

أثر هذه البنية: سرعة تطوير وتبسيط النشر، لكنها تزيد حساسية التعامل مع البيانات الحساسة مخزنّة على العميل، وتستدعي سياسات صارمة لتخفيف المخاطر.

---

## 4) التحديثات الأمنية الأخيرة (نقاط تركيز)
1) توحيد الوصول إلى صفحة المراقبة والتتبع «Observability» عبر كرت واحد إداري في لوحة التحكم، مع إزالة الدعوات المكررة من الصفحات الأخرى
2) تحسين تحميل ردود التذاكر: إيقاف سيل التوستات عند الفشل عبر التهدئة/التجميع والتعامل الرشيق عند تعطل الخلفية
3) دلائل أمنية عائمة قابلة للإغلاق ضمن عناوين الصفحات الحساسة:
   - إدارة المصادقة متعددة العوامل (MFA): نافذة عائمة مع مخطط Mermaid وخطوات عملية، فتح عبر العنوان أو زر أيقونة معلومات
   - أمان الجلسات: نفس النمط، يشرح المراقبة والإنهاء الآمن وربط MFA عند الشذوذ
   - إدارة الصلاحيات (RBAC): نفس النمط، يوضح مبدأ أقل الصلاحيات والتدقيق
4) تحسينات التعريب والاتجاه RTL وتوحيد تنسيق التواريخ العربية بأرقام لاتينية

النتيجة: تقليل فوضى التنقل، رفع وعي المستخدم الأمني داخل الصفحات الحساسة، وتجربة أكثر ثباتاً عند وقوع أخطاء شبكة.

---

## 5) نقاط القوة (المزايا)
1) تجربة مستخدم محسّنة على الصفحات الأمنية:
   - الدليل الأمني السياقي (Modal) يسهل الفهم دون مغادرة السياق
   - إمكانية الإغلاق بالضغط خارج/زر/مفتاح Esc (إتاحة أفضل)
2) مراقبة مركزية للمسارات الحساسة:
   - كرت مراقبة وتتبع النظام للإداريين فقط يحد من الانتشار الزائد لنقاط دخول حساسة
3) مرونة الأداء وحجم الحزمة:
   - استيراد ديناميكي لمكتبات ثقيلة (PDF/OCR/QR) يقلص زمن التحميل الأولي
4) تقليل إزعاج الإشعارات:
   - تهدئة التوستات مع التجميع لكل تذكرة يمنع الرسائل المتكررة
5) دعم عربي وRTL جيد:
   - اتساق التسمية وواجهة موجهة باللغة العربية مع مراعاة سهولة القراءة
6) بساطة النشر ومتطلبات البنية:
   - Vite + React مع Capacitor يسرّعان طرح النسخ ويقللان التعقيد التشغيلي

---

## 6) نقاط الضعف والمخاطر (العيوب)
يُذكر لكل بند: الشدة/الاحتمال/الأثر/توصية مختصرة.

1) الاعتماد على `localStorage` لبيانات حساسة (متوسطة/متوسطة/متوسط-عال)
   - الأثر: إمكانية وصول عبر جهاز مخترق/مشترك، صعوبة إنفاذ سياسات الاحتفاظ
   - التوصية: نقل البيانات الحساسة/الدائمة إلى واجهة خادمية مع توكنات جلسة قصيرة الأمد وتشفير موجه للخادم

2) عدم اكتمال العزل على مستوى البيانات (RBAC على مستوى الصف/السجل) (عال/متوسط/عال)
   - الأثر: احتمال تسريبات عرض/تعديل خارج القسم أو الدور في حالات حواف
   - التوصية: فرض فلاتر على مستوى الاستعلامات/الخدمة مع اختبارات وصول وحدية وتكاملية

3) سياسة خصوصية وشفافية تخزين غير موثّقة بشكل رسمي (متوسطة/عالية/متوسط)
   - الأثر: التزامات قانونية وتنظيمية؛ ثقة المستخدمين
   - التوصية: نشر سياسة خصوصية محسّنة، صفحة «إعدادات الخصوصية»، إشعار واضح عند التخزين المحلي

4) تغطية اختبارات غير كافية للمسارات الأمنية الحرجة (عال/متوسطة/عال)
   - الأثر: قابلية ارتداد أخطاء/انحدار في التحديثات اللاحقة
   - التوصية: إضافة اختبارات وحدة وتكامل لمصادقة MFA، RBAC، وتدفق الردود

5) ضعف صلابة «الوضع بلا شبكة/تعثر الخلفية» خارج المسارات التي تم تحسينها (متوسطة/متوسطة/متوسط)
   - الأثر: تجربة ناقصة في أجزاء لم تُغطّ بعد
   - التوصية: تعميم نمط «التدهور الرشيق» على جميع الواجهات الشبكية

6) إدارة أسرار/مفاتيح عبر الواجهة قد تكون عرضة لإساءة الاستخدام (متوسطة/منخفضة/متوسط)
   - الأثر: مفاتيح مثل `x-api-key` ضمن العميل
   - التوصية: قصر المفاتيح على الخادم واستخدام بروكسي مؤمن أو OAuth مع نطاقات دقيقة

7) الاعتماد على التوجيه بالهاش Hash فقط (منخفضة/منخفضة/منخفض)
   - الأثر: قيود على SEO وبعض سياسات التوجيه
   - التوصية: النظر في Router بدعم تاريخ المتصفح حيثما يلزم مع حواجز أمان

---

## 7) توصيات عملية مرتّبة الأولوية

أ) مكاسب سريعة (0–2 أسابيع)
- توثيق سياسة خصوصية رسمية وراية موافقة/إعدادات خصوصية داخل التطبيق
- تعميم «التدهور الرشيق» وتهدئة التوستات على بقية نقاط الجلب الشبكي
- إضافة دلائل أمنية عائمة للحوكمة والعمليات (إن لم تكن موجودة) مع محتوى موجه للمعنيين

ب) قصير الأمد (2–6 أسابيع)
- طبقة خدمة خادمية للنقاط الحساسة (جلسات، صلاحيات، ردود) بدل التخزين المحلي
- تطبيق RBAC على مستوى البيانات في الخادم مع اختبارات وصول مغطية للحالات الطرفية
- تعزيز تسجيل/تدقيق عمليات RBAC ونقل الأثر للمراقبة الإدارية

ج) متوسط الأمد (6–12 أسبوعًا)
- اعتماد توكنات جلسة قصيرة الأمد + تجديد صامت + قيود IP/جهاز عند الحاجة
- إضافة اختبارات وحدة/تكامل آلية (CI) تغطي MFA، الجلسات، RBAC، التقارير
- تحسينات قابلية المراجعة: لوائح احتفاظ بيانات، إجراءات مسح آمن، تتبع تغييرات السياسات

د) طويل الأمد
- مسار ترحيل تدريجي لبيانات المواطنين الحساسة إلى مستودع آمن مركزي مع تشفير منتظم
- اعتماد بوابة هوية موحدة إذا توفرت (SSO/MFA مؤسسي) وربطها بالأدوار المؤسسية

---

## 8) مؤشرات قياس الأداء (KPIs) والمتابعة
- نسبة نجاح عمليات القراءة/الكتابة في وجه تعثر الخلفية (> 99% مع تدهور رشيق)
- متوسط زمن فتح الصفحات الأمنية (P95 < 1.2s على الأجهزة الشائعة)
- معدّل إشعارات الفشل المكررة (↓ 80% بعد التهدئة)
- تغطية الاختبارات للوحدات الأمنية (> 70% خلال 3 أشهر)
- حوادث الوصول غير المصرح به (0، مع تدقيق شهري)
- نسبة تفعيل MFA للمستخدمين المستهدفين (> 90%)

---

## 9) الامتثال والحوكمة
- الامتثال الداخلي: تعزيز وثائق السياسات (الخصوصية، الاحتفاظ، صلاحيات الوصول)
- مراقبة إدارية: بطاقة مراقبة موحّدة للإداريين فقط مع تقارير قابلة للتصدير
- الحوكمة العملية: توصية بإجراءات موافقة للتغييرات الحساسة (RBAC/سياسات)

---

## 10) الخلاصة
التحسينات الأخيرة رفعت مستوى الأمان وتجربة الاستخدام بشكل واضح، خاصة عبر توحيد نقاط الوصول الحساسة وتقليل ضجيج التوستات وإضافة دلائل أمنية تفاعلية. يبقى التحدي الأكبر هو تقليل اعتماد التخزين المحلي للبيانات الحساسة، وإرساء ضوابط وصول على مستوى البيانات مدعومة بخادم واختبارات آلية. تنفيذ خريطة الطريق المقترحة سيُحسّن الدرجة التراكمية للأمان والامتثال ويُرسّخ الثقة المؤسسية والمواطنية.

---

## ملحق أ) مصفوفة المخاطر المختصرة
| الخطر | الشدة | الاحتمال | الأثر | التوصية | أولوية |
|---|---|---|---|---|---|
| بيانات حساسة في localStorage | عال | متوسط | عال | نقل للخادم + تشفير + توكنات قصيرة | عالية |
| نقص RBAC على مستوى البيانات | عال | متوسط | عال | تطبيق RBAC على الاستعلامات مع اختبارات | عالية |
| نقص سياسة خصوصية مفصّلة | متوسطة | عالية | متوسط | نشر سياسة وإعدادات خصوصية | عالية |
| تغطية اختبارات منخفضة | عال | متوسطة | عال | إضافة اختبارات CI للأمن | متوسطة |
| مفاتيح على العميل | متوسطة | منخفضة | متوسط | حصر على الخادم/بروكسي | متوسطة |

---

## ملحق ب) التحديثات التي شملها التقييم (سبتمبر 2025)
- بطاقة مراقبة «Observability» إدارية فقط + إزالة CTAs متكررة
- معالجة سيل التوستات بتحميل الردود (تهدئة وتجميع)
- دلائل أمنية عائمة على عناوين: MFA، أمان الجلسات، إدارة الصلاحيات (Mermaid + خطوات)
- تحسينات RTL/تعريب وتنسيق التاريخ العربي
