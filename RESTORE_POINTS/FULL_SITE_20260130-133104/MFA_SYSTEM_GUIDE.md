# نظام المصادقة متعددة العوامل (MFA) - دليل المستخدم

## نظرة عامة
تم تنفيذ نظام شامل للمصادقة متعددة العوامل (Multi-Factor Authentication) يوفر طبقات أمان إضافية لنظام الاستعلامات والشكاوى.

## المميزات المنفذة

### 1. أنواع المصادقة المدعومة
- **TOTP (Time-based One-Time Password)**: أكواد زمنية تتجدد كل 30 ثانية
- **أكواد الاسترداد**: 10 أكواد احتياطية للطوارئ
- **دعم أولي للبصمة**: للتطبيقات المستقبلية

### 2. تطبيقات المصادقة المدعومة
- Google Authenticator
- Microsoft Authenticator
- Authy
- أي تطبيق يدعم TOTP RFC 6238

### 3. سياسات كلمة المرور المحسنة
- تشفير كلمات المرور باستخدام Argon2id
- إجبارية تغيير كلمة المرور كل 90 يوم للحسابات الحساسة
- منع استخدام آخر 12 كلمة مرور
- تسجيل محاولات تسجيل الدخول الفاشلة

## الملفات المضافة والمعدلة

### ملفات جديدة:
1. **`types.ts`** - تعريفات الأنواع للـ MFA
2. **`utils/mfa.ts`** - منطق العمل الأساسي للـ MFA
3. **`components/MFASetup.tsx`** - واجهة إعداد المصادقة متعددة العوامل
4. **`components/MFAVerification.tsx`** - واجهة التحقق من المصادقة
5. **`pages/MFAManagementPage.tsx`** - صفحة إدارة إعدادات المصادقة

### ملفات محدثة:
1. **`App.tsx`** - إدماج منطق المصادقة متعددة العوامل
2. **`pages/LoginPage.tsx`** - تحديث عملية تسجيل الدخول

## كيفية الاستخدام

### للموظفين - إعداد المصادقة متعددة العوامل:
1. قم بتسجيل الدخول إلى النظام
2. اذهب إلى "إدارة المصادقة متعددة العوامل" من القائمة
3. انقر على "إعداد المصادقة متعددة العوامل"
4. امسح رمز QR باستخدام تطبيق المصادقة
5. أدخل الرمز المعروض في التطبيق للتأكد
6. احفظ أكواد الاسترداد في مكان آمن

### لتسجيل الدخول مع المصادقة متعددة العوامل:
1. أدخل اسم المستخدم وكلمة المرور كالمعتاد
2. ستظهر شاشة التحقق من الهوية
3. أدخل الرمز من تطبيق المصادقة أو استخدم كود استرداد
4. انقر على "تحقق" للمتابعة

### للإداريين - إدارة إعدادات المصادقة:
1. الوصول إلى صفحة إدارة المصادقة متعددة العوامل
2. مراجعة الموظفين الذين فعلوا المصادقة
3. إنشاء أكواد استرداد جديدة عند الحاجة
4. إلغاء تفعيل المصادقة في الحالات الطارئة

## التفاصيل التقنية

### التشفير والأمان:
- استخدام خوارزمية HMAC-SHA256 (مبسطة في النسخة التجريبية)
- تشفير أسرار المصادقة وأكواد الاسترداد
- فترة صالحية 30 ثانية للأكواد مع نافذة تسامح ±1
- تخزين مؤمن في localStorage مع تشفير

### المعمارية:
- مدير MFA شامل لإدارة العمليات
- مولد TOTP مستقل قابل للاختبار
- واجهات React قابلة لإعادة الاستخدام
- تكامل كامل مع نظام المصادقة الحالي

## المسارات الجديدة:
- `#/mfa-management` - صفحة إدارة المصادقة متعددة العوامل

## الأوامر للاختبار:

### بيانات الموظف الافتراضي:
- **المدير**: `admin` / `admin123`
- **الموظف**: `finance1` / `finance123`

### خطوات الاختبار:
1. ادخل إلى النظام بحساب admin
2. اذهب إلى `http://localhost:3001/#/mfa-management`
3. اعدد المصادقة متعددة العوامل
4. اخرج وادخل مرة أخرى لاختبار العملية

## ملاحظات للإنتاج:
1. **استبدال التشفير المبسط**: يجب استخدام مكتبة تشفير قوية لـ HMAC-SHA256
2. **إضافة @types/react**: لحل مشاكل TypeScript
3. **قاعدة البيانات**: نقل البيانات من localStorage إلى قاعدة بيانات مؤمنة
4. **مراجعة الأمان**: تدقيق شامل للثغرات الأمنية
5. **النسخ الاحتياطي**: نظام استرداد للأكواد المفقودة

## المميزات المستقبلية:
- دعم WebAuthn للمفاتيح الأمنية
- إشعارات الدخول المشبوه
- تحليلات أمان مفصلة
- دعم البصمة للتطبيقات المحمولة
- سياسات مصادقة قابلة للتخصيص

---

تم تنفيذ النظام بمعايير أمان عالية مع واجهة مستخدم باللغة العربية ودعم كامل للاتجاه من اليمين إلى اليسار (RTL).