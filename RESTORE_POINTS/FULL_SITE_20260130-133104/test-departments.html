<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… - Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ù„Ù„Ù…Ø±Ø§Ø³Ù„Ø§Øª</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #0f3c35 0%, #1a5752 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .department-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .department-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .btn {
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 70, 229, 0.4);
        }
        .select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: white;
            width: 100%;
            margin-top: 10px;
        }
        .select option {
            background: #1a5752;
            color: white;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin-top: 15px;
        }
        .status.success {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.5);
        }
        .status.error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ›ï¸ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… - Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ù„Ù„Ù…Ø±Ø§Ø³Ù„Ø§Øª</h1>
            <p>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù…Ù† Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ</p>
        </div>

        <div class="test-section">
            <h2>ğŸ“‹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…ØªÙˆÙØ±Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
            <p>Ù‡Ø°Ù‡ Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ localStorage:</p>
            <div id="departmentsList" class="department-list">
                <div class="department-item">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
            </div>
            
            <button class="btn" onclick="loadDepartments()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</button>
            <button class="btn" onclick="addSampleDepartments()">â• Ø¥Ø¶Ø§ÙØ© Ø£Ù‚Ø³Ø§Ù… ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
            <button class="btn" onclick="clearDepartments()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</button>
        </div>

        <div class="test-section">
            <h2>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ù…ÙƒÙˆÙ† Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø§Øª</h2>
            <p>Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø³Ù… Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©:</p>
            
            <select id="departmentSelect" class="select">
                <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
            </select>

            <div id="testStatus" class="status" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ’¾ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
            <button class="btn" onclick="generateSampleMessages()">ğŸ“„ Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø³Ø§Ø¦Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
            <button class="btn" onclick="clearMessages()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</button>
            <button class="btn" onclick="viewStorageData()">ğŸ‘ï¸ Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ†</button>
        </div>
    </div>

    <script>
        // Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù…Ù† Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ
        const defaultDepartments = [
            'Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©',
            'Ù‚Ø³Ù… Ø§Ù„Ø¯Ø®Ù„',
            'Ù‚Ø³Ù… ÙƒØ¨Ø§Ø± ÙˆÙ…ØªÙˆØ³Ø·ÙŠ Ø§Ù„Ù…ÙƒÙ„ÙÙŠÙ†',
            'Ù‚Ø³Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙŠÙˆÙ†',
            'Ù‚Ø³Ù… Ø§Ù„ÙˆØ§Ø±Ø¯Ø§Øª',
            'Ù‚Ø³Ù… Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©',
            'Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØ©',
            'Ù‚Ø³Ù… Ø§Ù„ØªÙ†Ù…ÙŠØ© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©',
            'Ù‚Ø³Ù… Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…',
            'Ù‚Ø³Ù… Ø§Ù„Ø®Ø²ÙŠÙ†Ø©'
        ];

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù…Ù† localStorage
        function loadDepartments() {
            try {
                const stored = localStorage.getItem('departmentsList');
                const departments = stored ? JSON.parse(stored) : [];
                
                if (!Array.isArray(departments) || departments.length === 0) {
                    showStatus('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù… Ù…Ø­ÙÙˆØ¸Ø©. Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©.', 'error');
                    return displayDepartments(defaultDepartments.map(name => ({ name })));
                }

                displayDepartments(departments);
                updateSelectOptions(departments);
                showStatus(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${departments.length} Ù‚Ø³Ù…Ø§Ù‹ Ø¨Ù†Ø¬Ø§Ø­`, 'success');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…:', error);
                showStatus('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…', 'error');
                displayDepartments(defaultDepartments.map(name => ({ name })));
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        function displayDepartments(departments) {
            const container = document.getElementById('departmentsList');
            
            if (!departments || departments.length === 0) {
                container.innerHTML = '<div class="department-item">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù… Ù…ØªÙˆÙØ±Ø©</div>';
                return;
            }

            container.innerHTML = departments.map((dept, index) => `
                <div class="department-item">
                    <strong>${index + 1}.</strong> ${dept.name || dept}
                </div>
            `).join('');
        }

        // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
        function updateSelectOptions(departments) {
            const select = document.getElementById('departmentSelect');
            select.innerHTML = '<option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>';
            
            departments.forEach(dept => {
                const option = document.createElement('option');
                option.value = dept.name || dept;
                option.textContent = dept.name || dept;
                select.appendChild(option);
            });
        }

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
        function addSampleDepartments() {
            const departments = defaultDepartments.map(name => ({ name }));
            localStorage.setItem('departmentsList', JSON.stringify(departments));
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø­Ø¯Ø« ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            window.dispatchEvent(new Event('departmentsListUpdated'));
            
            loadDepartments();
            showStatus(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${departments.length} Ù‚Ø³Ù…Ø§Ù‹ ØªØ¬Ø±ÙŠØ¨ÙŠØ§Ù‹`, 'success');
        }

        // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        function clearDepartments() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…ØŸ')) {
                localStorage.removeItem('departmentsList');
                window.dispatchEvent(new Event('departmentsListUpdated'));
                loadDepartments();
                showStatus('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…', 'success');
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø³Ø§Ø¦Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
        function generateSampleMessages() {
            const stored = localStorage.getItem('departmentsList');
            const departments = stored ? JSON.parse(stored) : defaultDepartments.map(name => ({ name }));
            const departmentNames = departments.map(d => d.name || d);
            
            const messages = [];
            
            for (let i = 0; i < 15; i++) {
                const dept = departmentNames[Math.floor(Math.random() * departmentNames.length)];
                const isFromDiwan = Math.random() > 0.5;
                const sentDate = new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000);
                const priority = Math.random() > 0.7 ? 'Ø¹Ø§Ø¬Ù„' : Math.random() > 0.5 ? 'Ù‡Ø§Ù…' : 'Ø¹Ø§Ø¯ÙŠ';

                messages.push({
                    id: `internal_${Date.now()}_${i}`,
                    from: isFromDiwan ? 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙŠÙˆØ§Ù† Ø§Ù„Ø¹Ø§Ù…' : dept,
                    to: isFromDiwan ? dept : 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙŠÙˆØ§Ù† Ø§Ù„Ø¹Ø§Ù…',
                    subject: `${isFromDiwan ? 'ØªØ¹Ù„ÙŠÙ…Ø§Øª' : 'ØªÙ‚Ø±ÙŠØ±'} ${priority === 'Ø¹Ø§Ø¬Ù„' ? 'Ø¹Ø§Ø¬Ù„' : ''} - ${dept}`,
                    content: `Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù€ ${dept} Ø¨Ø®ØµÙˆØµ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© ${priority === 'Ø¹Ø§Ø¬Ù„' ? 'Ø§Ù„Ø¹Ø§Ø¬Ù„Ø©' : 'Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©'}`,
                    priority,
                    status: Math.random() > 0.3 ? 'Ù…Ø¬Ø§Ø¨' : 'Ù‚ÙŠØ¯_Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
                    sentAt: sentDate.toISOString(),
                    receivedAt: new Date(sentDate.getTime() + Math.random() * 2 * 60 * 60 * 1000).toISOString(),
                    respondedAt: Math.random() > 0.5 ? new Date(sentDate.getTime() + Math.random() * 24 * 60 * 60 * 1000).toISOString() : null,
                    direction: isFromDiwan ? 'Ù…Ù†_Ø§Ù„Ø¯ÙŠÙˆØ§Ù†' : 'Ø¥Ù„Ù‰_Ø§Ù„Ø¯ÙŠÙˆØ§Ù†'
                });
            }
            
            localStorage.setItem('internalMessages', JSON.stringify(messages));
            showStatus(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ${messages.length} Ø±Ø³Ø§Ù„Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ${departmentNames.length} Ù‚Ø³Ù…Ø§Ù‹`, 'success');
        }

        // Ù…Ø³Ø­ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        function clearMessages() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŸ')) {
                localStorage.removeItem('internalMessages');
                showStatus('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„', 'success');
            }
        }

        // Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ†
        function viewStorageData() {
            const data = {
                departments: localStorage.getItem('departmentsList'),
                messages: localStorage.getItem('internalMessages')
            };
            
            console.log('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ†:', data);
            
            const deptCount = data.departments ? JSON.parse(data.departments).length : 0;
            const msgCount = data.messages ? JSON.parse(data.messages).length : 0;
            
            showStatus(`Ø§Ù„Ø£Ù‚Ø³Ø§Ù…: ${deptCount} | Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: ${msgCount} - Ø§Ù†Ø¸Ø± ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„ØªÙØ§ØµÙŠÙ„`, 'success');
        }

        // Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
        function showStatus(message, type) {
            const statusDiv = document.getElementById('testStatus');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 4000);
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            loadDepartments();
        });

        // Ù…Ø±Ø§Ù‚Ø¨Ø© ØªØºÙŠÙŠØ± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø³Ù…
        document.getElementById('departmentSelect').addEventListener('change', function() {
            const selectedDept = this.value;
            showStatus(`ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: ${selectedDept}`, 'success');
        });
    </script>
</body>
</html>