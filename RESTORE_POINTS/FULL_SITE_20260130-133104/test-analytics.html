<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงุฎุชุจุงุฑ ุงูุฅุญุตุงุฆูุงุช ุงูุฒูููุฉ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #0066cc;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0052a3;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: #f0f8ff;
            border-radius: 5px;
            border-left: 4px solid #0066cc;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>๐ ุงุฎุชุจุงุฑ ูุธุงู ุงูุฅุญุตุงุฆูุงุช ุงูุฒูููุฉ ููุฑุณุงุฆู ุงูุฏุงุฎููุฉ</h1>
        
        <div class="section">
            <h3>ุฅุถุงูุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ</h3>
            <button class="test-button" onclick="createTestData()">ุฅูุดุงุก ุฑุณุงุฆู ุชุฌุฑูุจูุฉ</button>
            <button class="test-button" onclick="clearData()">ูุณุญ ุงูุจูุงูุงุช</button>
            <button class="test-button" onclick="viewData()">ุนุฑุถ ุงูุจูุงูุงุช</button>
        </div>

        <div class="section">
            <h3>ุงุฎุชุจุงุฑ ุงููุธุงุฆู</h3>
            <button class="test-button" onclick="testMessageAnalytics()">ุงุฎุชุจุงุฑ ุงูุฅุญุตุงุฆูุงุช</button>
            <button class="test-button" onclick="testDepartmentFilter()">ุงุฎุชุจุงุฑ ููุชุฑ ุงูุฃูุณุงู</button>
            <button class="test-button" onclick="testTimeFilters()">ุงุฎุชุจุงุฑ ุงูููุงุชุฑ ุงูุฒูููุฉ</button>
            <button class="test-button" onclick="testAIAnalysis()">ุงุฎุชุจุงุฑ ุงูุชุญููู ุงูุฐูู</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        function log(message) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = 'result';
            div.innerHTML = `<strong>${new Date().toLocaleTimeString('ar-SY')}:</strong> ${message}`;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }

        function createTestData() {
            const testMessages = [
                {
                    id: 'msg-001',
                    title: 'ุทูุจ ูุนูููุงุช ูุงููุฉ',
                    content: 'ูุฑุฌู ุชุฒููุฏูุง ุจุชูุฑูุฑ ูุงูู ุนู ุงูุฑุจุน ุงูุฃูู',
                    fromDepartment: 'ูุณู ุงููุญุงุณุจุฉ',
                    toDepartments: ['ูุณู ุงููุฑุงุฌุนุฉ', 'ุงูุฅุฏุงุฑุฉ ุงูุนููุง'],
                    priority: 'ุนุงุฌู',
                    status: 'ููุฌุงุจ',
                    timestamp: new Date('2025-09-10T09:00:00').toISOString(),
                    readBy: [{ department: 'ูุณู ุงููุฑุงุฌุนุฉ', timestamp: new Date('2025-09-10T10:00:00').toISOString() }],
                    repliedBy: [{ department: 'ูุณู ุงููุฑุงุฌุนุฉ', timestamp: new Date('2025-09-10T11:00:00').toISOString(), content: 'ุชู ุฅุฑุณุงู ุงูุชูุฑูุฑ' }]
                },
                {
                    id: 'msg-002',
                    title: 'ุงุฌุชูุงุน ุทูุงุฑุฆ',
                    content: 'ุงุฌุชูุงุน ุทูุงุฑุฆ ุบุฏุงู ุงูุณุงุนุฉ 10 ุตุจุงุญุงู',
                    fromDepartment: 'ุงูุฅุฏุงุฑุฉ ุงูุนููุง',
                    toDepartments: ['ูุณู ุงููุญุงุณุจุฉ', 'ูุณู ุงููุฑุงุฌุนุฉ', 'ูุณู ุงูุฎุฒููุฉ'],
                    priority: 'ุนุงุฌู',
                    status: 'ุฌุฏูุฏ',
                    timestamp: new Date('2025-09-12T14:30:00').toISOString(),
                    readBy: [{ department: 'ูุณู ุงููุญุงุณุจุฉ', timestamp: new Date('2025-09-12T15:00:00').toISOString() }]
                },
                {
                    id: 'msg-003',
                    title: 'ุชุญุฏูุซ ุงูุณูุงุณุงุช ุงููุงููุฉ',
                    content: 'ูุฑุฌู ูุฑุงุฌุนุฉ ุงูุณูุงุณุงุช ุงููุงููุฉ ุงูุฌุฏูุฏุฉ ุงููุฑููุฉ',
                    fromDepartment: 'ูุณู ุงูุณูุงุณุงุช',
                    toDepartments: ['ูุณู ุงููุญุงุณุจุฉ'],
                    priority: 'ุนุงุฏู',
                    status: 'ูู ุงููุนุงูุฌุฉ',
                    timestamp: new Date('2025-09-14T08:15:00').toISOString()
                },
                {
                    id: 'msg-004',
                    title: 'ุชูุฑูุฑ ุดูุฑู',
                    content: 'ุงูุชูุฑูุฑ ุงููุงูู ุงูุดูุฑู ุฌุงูุฒ ูููุฑุงุฌุนุฉ',
                    fromDepartment: 'ูุณู ุงูุชูุงุฑูุฑ',
                    toDepartments: ['ูุณู ุงููุญุงุณุจุฉ', 'ุงูุฅุฏุงุฑุฉ ุงูุนููุง'],
                    priority: 'ูุงู',
                    status: 'ูู ุงููุนุงูุฌุฉ',
                    timestamp: new Date('2025-09-13T16:45:00').toISOString(),
                    readBy: [{ department: 'ุงูุฅุฏุงุฑุฉ ุงูุนููุง', timestamp: new Date('2025-09-13T17:00:00').toISOString() }]
                },
                {
                    id: 'msg-005',
                    title: 'ุงุณุชูุณุงุฑ ุญูู ุงูููุฒุงููุฉ',
                    content: 'ุงุณุชูุณุงุฑ ุญูู ุจูุฏ ูุนูู ูู ุงูููุฒุงููุฉ',
                    fromDepartment: 'ูุณู ุงูุชุฎุทูุท',
                    toDepartments: ['ูุณู ุงููุญุงุณุจุฉ'],
                    priority: 'ุนุงุฏู',
                    status: 'ุฌุฏูุฏ',
                    timestamp: new Date('2025-09-14T11:20:00').toISOString()
                }
            ];

            try {
                localStorage.setItem('internalMessages', JSON.stringify(testMessages));
                log(`โ ุชู ุฅูุดุงุก ${testMessages.length} ุฑุณุงุฆู ุชุฌุฑูุจูุฉ ุจูุฌุงุญ`);
            } catch (error) {
                log(`โ ุฎุทุฃ ูู ุฅูุดุงุก ุงูุจูุงูุงุช: ${error.message}`);
            }
        }

        function clearData() {
            localStorage.removeItem('internalMessages');
            log('๐๏ธ ุชู ูุณุญ ุฌููุน ุงูุจูุงูุงุช');
        }

        function viewData() {
            const messages = JSON.parse(localStorage.getItem('internalMessages') || '[]');
            log(`๐ ุนุฏุฏ ุงูุฑุณุงุฆู ุงููุญููุธุฉ: ${messages.length}`);
            if (messages.length > 0) {
                messages.forEach((msg, index) => {
                    log(`${index + 1}. ${msg.title} - ูู: ${msg.fromDepartment} - ุงูุฃููููุฉ: ${msg.priority}`);
                });
            }
        }

        function testMessageAnalytics() {
            const messages = JSON.parse(localStorage.getItem('internalMessages') || '[]');
            if (messages.length === 0) {
                log('โ ูุง ุชูุฌุฏ ุฑุณุงุฆู ููุชุญููู. ูู ุจุฅูุดุงุก ุจูุงูุงุช ุชุฌุฑูุจูุฉ ุฃููุงู');
                return;
            }

            // ุงุฎุชุจุงุฑ ุฅุญุตุงุฆูุงุช ุฃุณุงุณูุฉ
            const totalMessages = messages.length;
            const urgentMessages = messages.filter(msg => msg.priority === 'ุนุงุฌู').length;
            const repliedMessages = messages.filter(msg => msg.status === 'ููุฌุงุจ').length;
            
            log(`๐ ุฅุฌูุงูู ุงูุฑุณุงุฆู: ${totalMessages}`);
            log(`๐จ ุงูุฑุณุงุฆู ุงูุนุงุฌูุฉ: ${urgentMessages}`);
            log(`โ ุงูุฑุณุงุฆู ุงูููุฌุงุจุฉ: ${repliedMessages}`);
            log(`๐ ูุนุฏู ุงูุฑุฏ: ${Math.round((repliedMessages / totalMessages) * 100)}%`);

            // ุงุฎุชุจุงุฑ ุงูุฃูุณุงู
            const departments = new Set();
            messages.forEach(msg => {
                departments.add(msg.fromDepartment);
                msg.toDepartments.forEach(dept => departments.add(dept));
            });
            log(`๐ข ุนุฏุฏ ุงูุฃูุณุงู ุงููุดุงุฑูุฉ: ${departments.size}`);
            log(`๐ ุงูุฃูุณุงู: ${Array.from(departments).join(', ')}`);
        }

        function testDepartmentFilter() {
            const messages = JSON.parse(localStorage.getItem('internalMessages') || '[]');
            if (messages.length === 0) {
                log('โ ูุง ุชูุฌุฏ ุฑุณุงุฆู ููููุชุฑุฉ');
                return;
            }

            const testDepartment = 'ูุณู ุงููุญุงุณุจุฉ';
            const filtered = messages.filter(msg => 
                msg.fromDepartment === testDepartment || 
                msg.toDepartments.includes(testDepartment)
            );

            log(`๐ ุงุฎุชุจุงุฑ ููุชุฑ ุงููุณู: ${testDepartment}`);
            log(`๐ ุนุฏุฏ ุงูุฑุณุงุฆู ุงููุฑุชุจุทุฉ: ${filtered.length}`);
            filtered.forEach((msg, index) => {
                log(`  ${index + 1}. ${msg.title} - ${msg.fromDepartment === testDepartment ? 'ููุฑุณูู' : 'ููุณุชูุจูู'}`);
            });
        }

        function testTimeFilters() {
            const messages = JSON.parse(localStorage.getItem('internalMessages') || '[]');
            if (messages.length === 0) {
                log('โ ูุง ุชูุฌุฏ ุฑุณุงุฆู ููููุชุฑุฉ');
                return;
            }

            const today = new Date();
            const lastWeek = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            
            const recentMessages = messages.filter(msg => {
                const msgDate = new Date(msg.timestamp);
                return msgDate >= lastWeek && msgDate <= today;
            });

            log(`๐ ุงุฎุชุจุงุฑ ุงูููุชุฑ ุงูุฒููู: ุขุฎุฑ 7 ุฃูุงู`);
            log(`๐ ุนุฏุฏ ุงูุฑุณุงุฆู ูู ุงููุชุฑุฉ: ${recentMessages.length}`);
            recentMessages.forEach((msg, index) => {
                const date = new Date(msg.timestamp).toLocaleDateString('ar-SY');
                log(`  ${index + 1}. ${msg.title} - ${date}`);
            });

            // ุงุฎุชุจุงุฑ ุฅุญุตุงุฆูุงุช ููููุฉ
            const dailyStats = {};
            recentMessages.forEach(msg => {
                const date = new Date(msg.timestamp).toDateString();
                if (!dailyStats[date]) {
                    dailyStats[date] = { sent: 0, received: 0 };
                }
                dailyStats[date].sent++;
            });

            log(`๐ ุงูุฅุญุตุงุฆูุงุช ุงูููููุฉ:`);
            Object.entries(dailyStats).forEach(([date, stats]) => {
                log(`  ${new Date(date).toLocaleDateString('ar-SY')}: ${stats.sent} ุฑุณุงูุฉ`);
            });
        }

        function testAIAnalysis() {
            const messages = JSON.parse(localStorage.getItem('internalMessages') || '[]');
            if (messages.length === 0) {
                log('โ ูุง ุชูุฌุฏ ุฑุณุงุฆู ูุชุญููููุง');
                return;
            }

            log('๐ค ุงุฎุชุจุงุฑ ุงูุชุญููู ุงูุฐูู (ูุญุงูู)');
            
            // ุชุญููู ุชูุฒูุน ุงูุฃููููุงุช
            const priorityStats = {};
            messages.forEach(msg => {
                if (!priorityStats[msg.priority]) {
                    priorityStats[msg.priority] = 0;
                }
                priorityStats[msg.priority]++;
            });

            log('๐ ุฅุญุตุงุฆูุงุช ุงูุฃููููุงุช:');
            Object.entries(priorityStats).forEach(([priority, count]) => {
                const percentage = Math.round((count / messages.length) * 100);
                log(`  ${priority}: ${count} ุฑุณุงูุฉ (${percentage}%)`);
            });

            // ูุญุงูู ุชุญููู Gemini
            const urgentCount = priorityStats['ุนุงุฌู'] || 0;
            const totalCount = messages.length;
            const urgentRatio = urgentCount / totalCount;

            log('๐ง ุฑุคู ุงูุฐูุงุก ุงูุตูุงุนู (ูุญุงูู):');
            
            if (urgentRatio > 0.3) {
                log('โ๏ธ ุชุญุฐูุฑ: ูุณุจุฉ ุนุงููุฉ ูู ุงูุฑุณุงุฆู ุงูุนุงุฌูุฉ - ูููุตุญ ุจูุฑุงุฌุนุฉ ูุนุงููุฑ ุงูุฃููููุงุช');
                log('๐ก ุชูุตูุฉ: ุชุทููุฑ ูุธุงู ูุฑุนู ููุฃููููุงุช ูุชุฎุตูุต ูุฑูู ููุฑุณุงุฆู ุงูุนุงุฌูุฉ');
                log('๐ ููุงุท ุงูููุงุกุฉ: 65/100');
            } else if (urgentRatio < 0.1) {
                log('โ ููุชุงุฒ: ูุณุจุฉ ููุฎูุถุฉ ูู ุงูุฑุณุงุฆู ุงูุนุงุฌูุฉ ุชุดูุฑ ุฅูู ุชุฎุทูุท ุฌูุฏ');
                log('๐ก ุชูุตูุฉ: ุงูุญูุงุธ ุนูู ูุฐุง ุงููุณุชูู ูู ุงูุชูุธูู');
                log('๐ ููุงุท ุงูููุงุกุฉ: 90/100');
            } else {
                log('โ ุฌูุฏ: ุชูุฒูุน ูุชูุงุฒู ููุฃููููุงุช');
                log('๐ก ุชูุตูุฉ: ูุฑุงุฌุนุฉ ุฏูุฑูุฉ ููุฑุณุงุฆู ุงููุงูุฉ ูููุน ุชุญูููุง ูุนุงุฌูุฉ');
                log('๐ ููุงุท ุงูููุงุกุฉ: 80/100');
            }

            // ุชุญููู ุงูุฃูุณุงู
            const departmentActivity = {};
            messages.forEach(msg => {
                if (!departmentActivity[msg.fromDepartment]) {
                    departmentActivity[msg.fromDepartment] = { sent: 0, received: 0 };
                }
                departmentActivity[msg.fromDepartment].sent++;
                
                msg.toDepartments.forEach(dept => {
                    if (!departmentActivity[dept]) {
                        departmentActivity[dept] = { sent: 0, received: 0 };
                    }
                    departmentActivity[dept].received++;
                });
            });

            log('๐ข ุชุญููู ูุดุงุท ุงูุฃูุณุงู:');
            const mostActiveDept = Object.entries(departmentActivity)
                .sort(([,a], [,b]) => (b.sent + b.received) - (a.sent + a.received))[0];
            
            if (mostActiveDept) {
                log(`  ุงููุณู ุงูุฃูุซุฑ ูุดุงุทุงู: ${mostActiveDept[0]} (${mostActiveDept[1].sent + mostActiveDept[1].received} ุฑุณุงูุฉ)`);
            }

            // ุชุญููู ุฒููู
            const hourlyActivity = new Array(24).fill(0);
            messages.forEach(msg => {
                const hour = new Date(msg.timestamp).getHours();
                hourlyActivity[hour]++;
            });

            const peakHour = hourlyActivity.indexOf(Math.max(...hourlyActivity));
            log(`โฐ ุณุงุนุฉ ุงูุฐุฑูุฉ: ${peakHour}:00 (${Math.max(...hourlyActivity)} ุฑุณุงูุฉ)`);

            if (peakHour >= 9 && peakHour <= 11) {
                log('๐ก ุฑุคูุฉ: ุฐุฑูุฉ ุงููุดุงุท ูู ุณุงุนุงุช ุงูุตุจุงุญ ุงููุจูุฑุฉ - ุงุณุชุบู ูุฐุง ุงูููุช ููููุงู ุงููููุฉ');
            } else if (peakHour >= 14 && peakHour <= 16) {
                log('๐ก ุฑุคูุฉ: ุฐุฑูุฉ ุงููุดุงุท ุจุนุฏ ุงูุธูุฑ - ูุฏ ูุดูุฑ ุฅูู ุชุฑุงูู ููุงู ุงูุตุจุงุญ');
            }

            // ูุญุงูู ุชุญููู ุงููุฎุงุทุฑ
            const unansweredCount = messages.filter(msg => msg.status === 'ุฌุฏูุฏ' || msg.status === 'ูู ุงููุนุงูุฌุฉ').length;
            const riskLevel = unansweredCount > (totalCount * 0.3) ? 'ุนุงูู' : unansweredCount > (totalCount * 0.1) ? 'ูุชูุณุท' : 'ููุฎูุถ';
            
            log(`โ๏ธ ูุณุชูู ุงููุฎุงุทุฑ: ${riskLevel}`);
            log(`๐ ุงูุฑุณุงุฆู ุบูุฑ ุงููุฌุงุจุฉ: ${unansweredCount} ูู ${totalCount}`);

            // ูุญุงูู ุงูุชููุนุงุช
            const recentMessages = messages.filter(msg => {
                const msgDate = new Date(msg.timestamp);
                const threeDaysAgo = new Date();
                threeDaysAgo.setDate(threeDaysAgo.getDate() - 3);
                return msgDate >= threeDaysAgo;
            });

            if (recentMessages.length > totalCount * 0.6) {
                log('๐ฎ ุชููุน: ุฒูุงุฏุฉ ูู ุงููุดุงุท ุฎูุงู ุงูุฃูุงู ุงููุงุฏูุฉ - ุงุณุชุนุฏ ูุฐูู');
            } else {
                log('๐ฎ ุชููุน: ูุนุฏู ูุดุงุท ุทุจูุนู ูุชููุน');
            }

            log('๐ฏ ูุณุชูู ุงูุซูุฉ ูู ุงูุชุญููู: 85%');
            log('โฑ๏ธ ุขุฎุฑ ุชุญุฏูุซ: ' + new Date().toLocaleString('ar-SY-u-nu-latn'));
        }

        // ุชุดุบูู ุงุฎุชุจุงุฑ ุฃููู
        window.onload = function() {
            log('๐ ุชู ุชุญููู ุตูุญุฉ ุงูุงุฎุชุจุงุฑ ุจูุฌุงุญ');
            log('โ ุชู ุฅุตูุงุญ ูุดููุฉ process.env ูู ุงูุจูุฆุฉ Browser');
            log('๐ก ูู ุจุฅูุดุงุก ุจูุงูุงุช ุชุฌุฑูุจูุฉ ุฃููุงู ุซู ุงุฎุชุจุฑ ุงููุธุงุฆู ุงููุฎุชููุฉ');
            log('๐ค ุงูุชุญููู ุงูุฐูู ูุนูู ูู ูุถุน ุงููุญุงูู (ูุง ูุชุทูุจ Gemini API key)');
            
            // ุงุฎุชุจุงุฑ ุฃููู ููุชุญููู ุงูุฐูู
            log('๐ ุงุฎุชุจุงุฑ ุงูุชุญููู ุงูุฐูู...');
            const mockMessages = [
                { priority: 'ุนุงุฌู', timestamp: new Date().toISOString() },
                { priority: 'ูุงู', timestamp: new Date().toISOString() },
                { priority: 'ุนุงุฏู', timestamp: new Date().toISOString() }
            ];
            
            if (mockMessages.length > 0) {
                log('โ ูุฌุญ ุงุฎุชุจุงุฑ ุงูุชุญููู ุงูุฐูู ุงูุฃููู');
                log('๐ ุงููุญุงูู ุฌุงูุฒ ูุชุญููู ุงูุจูุงูุงุช');
            }
        };
    </script>
</body>
</html>